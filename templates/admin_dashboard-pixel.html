{% extends "base-pixel.html" %}

{% block title %}Admin Dashboard - Prompts Library v1.0{% endblock %}

{% block extra_css %}
<style>
.admin-dashboard {
    padding: 2rem 0;
}

.admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid rgba(122, 92, 255, 0.3);
}

.admin-header h1 {
    font-family: 'VT323', monospace;
    font-size: 2.5rem;
    color: var(--pixel-cyan);
    margin: 0;
    text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
}

.stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: linear-gradient(135deg, rgba(122, 92, 255, 0.1) 0%, rgba(157, 78, 221, 0.05) 100%);
    border: 2px solid var(--pixel-purple);
    border-radius: 12px;
    padding: 1.5rem;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
    border-color: var(--pixel-cyan);
    box-shadow: 0 10px 30px rgba(122, 92, 255, 0.3);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(0, 255, 255, 0.1) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.stat-card:hover::before {
    opacity: 1;
}

.stat-icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    display: inline-block;
}

.stat-icon.users { color: #00d4ff; }
.stat-icon.creators { color: #ffd700; }
.stat-icon.circles { color: #9d4edd; }
.stat-icon.prompts { color: #ff6ec7; }
.stat-icon.coins { color: #ffa500; }

.stat-label {
    font-family: 'VT323', monospace;
    font-size: 1.1rem;
    color: rgba(248, 249, 250, 0.7);
    margin-bottom: 0.5rem;
}

.stat-value {
    font-family: 'VT323', monospace;
    font-size: 2.5rem;
    color: var(--pixel-white);
    font-weight: bold;
    line-height: 1;
}

.stat-subtext {
    font-family: 'VT323', monospace;
    font-size: 0.95rem;
    color: rgba(248, 249, 250, 0.5);
    margin-top: 0.5rem;
}

.admin-section {
    background: rgba(122, 92, 255, 0.05);
    border: 2px solid rgba(122, 92, 255, 0.3);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(122, 92, 255, 0.2);
}

.section-title {
    font-family: 'VT323', monospace;
    font-size: 1.8rem;
    color: var(--pixel-purple);
    margin: 0;
}

.pixel-btn-sm {
    padding: 0.5rem 1.5rem;
    font-family: 'VT323', monospace;
    font-size: 1rem;
    background: var(--pixel-purple);
    color: white;
    border: 2px solid var(--pixel-purple);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
}

.pixel-btn-sm:hover {
    background: transparent;
    color: var(--pixel-purple);
    transform: translateY(-2px);
}

.admin-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
}

.admin-table thead {
    background: rgba(122, 92, 255, 0.1);
}

.admin-table th {
    font-family: 'VT323', monospace;
    font-size: 1.2rem;
    color: var(--pixel-cyan);
    padding: 1rem;
    text-align: left;
    border-bottom: 2px solid rgba(122, 92, 255, 0.3);
}

.admin-table td {
    font-family: 'VT323', monospace;
    font-size: 1.1rem;
    color: var(--pixel-white);
    padding: 1rem;
    border-bottom: 1px solid rgba(122, 92, 255, 0.1);
}

.admin-table tr:hover {
    background: rgba(0, 255, 255, 0.05);
}

.badge-pixel {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    font-family: 'VT323', monospace;
    font-size: 0.95rem;
    border-radius: 6px;
    border: 1px solid;
}

.badge-success { background: rgba(40, 167, 69, 0.2); color: #28a745; border-color: #28a745; }
.badge-warning { background: rgba(255, 193, 7, 0.2); color: #ffc107; border-color: #ffc107; }
.badge-info { background: rgba(0, 212, 255, 0.2); color: #00d4ff; border-color: #00d4ff; }

.action-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.action-btn {
    padding: 1rem;
    font-family: 'VT323', monospace;
    font-size: 1.2rem;
    background: rgba(122, 92, 255, 0.1);
    color: var(--pixel-cyan);
    border: 2px solid var(--pixel-purple);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.action-btn:hover {
    background: var(--pixel-purple);
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 5px 20px rgba(122, 92, 255, 0.4);
}

.user-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.user-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border-bottom: 1px solid rgba(122, 92, 255, 0.1);
    transition: background 0.3s ease;
}

.user-item:hover {
    background: rgba(0, 255, 255, 0.05);
}

.user-info a {
    font-family: 'VT323', monospace;
    font-size: 1.2rem;
    color: var(--pixel-cyan);
    text-decoration: none;
    font-weight: bold;
}

.user-info a:hover {
    text-decoration: underline;
}

.user-email {
    font-family: 'VT323', monospace;
    font-size: 1rem;
    color: rgba(248, 249, 250, 0.6);
    margin-top: 0.25rem;
}

@media (max-width: 768px) {
    .stat-grid {
        grid-template-columns: 1fr;
    }
    .admin-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="pixel-container admin-dashboard">
    <div class="admin-header">
        <h1><i class="fas fa-chart-line"></i> Admin Dashboard</h1>
        <div style="font-family: 'VT323', monospace; font-size: 1.2rem; color: rgba(248, 249, 250, 0.7);">
            <i class="fas fa-clock"></i> {{ now.strftime('%b %d, %Y â€¢ %H:%M') if now is defined else '' }}
        </div>
    </div>

    <!-- Statistics Grid -->
    <div class="stat-grid">
        <div class="stat-card">
            <div class="stat-icon users"><i class="fas fa-users"></i></div>
            <div class="stat-label">Total Users</div>
            <div class="stat-value">{{ stats.total_users }}</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon creators"><i class="fas fa-crown"></i></div>
            <div class="stat-label">Total Creators</div>
            <div class="stat-value">{{ stats.total_creators }}</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon circles"><i class="fas fa-circle-notch"></i></div>
            <div class="stat-label">Active Circles</div>
            <div class="stat-value">{{ stats.total_circles }}</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon prompts"><i class="fas fa-lightbulb"></i></div>
            <div class="stat-label">Total Prompts</div>
            <div class="stat-value">{{ stats.total_prompts }}</div>
            <div class="stat-subtext">{{ stats.exclusive_prompts }} exclusive</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon coins"><i class="fas fa-coins"></i></div>
            <div class="stat-label">PM Coins in Circulation</div>
            <div class="stat-value">{{ "{:,}".format(stats.total_coins_circulation) }}</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon coins"><i class="fas fa-chart-line"></i></div>
            <div class="stat-label">Coins Earned by Creators</div>
            <div class="stat-value">{{ "{:,}".format(stats.total_coins_earned) }}</div>
        </div>
    </div>

    <!-- Recent Transactions Section -->
    <div class="admin-section">
        <div class="section-header">
            <h3 class="section-title"><i class="fas fa-exchange-alt"></i> Recent Transactions</h3>
            <a href="{{ url_for('admin_transactions') }}" class="pixel-btn-sm">View All</a>
        </div>
        <div style="overflow-x: auto;">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Description</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for txn in stats.recent_transactions %}
                    <tr>
                        <td>
                            <a href="{{ url_for('public_profile', username=txn.user.username) }}" style="color: var(--pixel-cyan); text-decoration: none;">
                                {{ txn.user.username }}
                            </a>
                        </td>
                        <td>
                            {% if txn.transaction_type == 'add' %}
                                <span class="badge-pixel badge-success">Purchase</span>
                            {% elif txn.transaction_type == 'spend' %}
                                <span class="badge-pixel badge-warning">Spend</span>
                            {% elif txn.transaction_type == 'earn' %}
                                <span class="badge-pixel badge-info">Earn</span>
                            {% endif %}
                        </td>
                        <td style="color: {% if txn.transaction_type == 'spend' %}#ff6ec7{% else %}#00d4ff{% endif %};">
                            <strong>{% if txn.transaction_type == 'spend' %}-{% else %}+{% endif %}{{ txn.amount }} ðŸ’°</strong>
                        </td>
                        <td style="color: rgba(248, 249, 250, 0.7);">{{ txn.description[:40] }}...</td>
                        <td style="color: rgba(248, 249, 250, 0.5);">{{ txn.created_at.strftime('%m/%d %H:%M') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Recent Users Section -->
    <div class="admin-section">
        <div class="section-header">
            <h3 class="section-title"><i class="fas fa-user-plus"></i> Recent Users</h3>
            <a href="{{ url_for('admin_users') }}" class="pixel-btn-sm">View All</a>
        </div>
        <ul class="user-list">
            {% for user in stats.recent_users %}
            <li class="user-item">
                <div class="user-info">
                    <a href="{{ url_for('public_profile', username=user.username) }}">{{ user.username }}</a>
                    {% if user.user_role == 'creator' or user.user_role == 'admin' %}
                        <span class="badge-pixel badge-info" style="margin-left: 0.5rem;">Creator</span>
                    {% endif %}
                    <div class="user-email">{{ user.email }}</div>
                </div>
                <div style="font-family: 'VT323', monospace; font-size: 1rem; color: rgba(248, 249, 250, 0.5); text-align: right;">
                    {{ user.created_at.strftime('%m/%d/%Y') }}
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>

    <!-- Quick Actions -->
    <div class="admin-section">
        <div class="section-header">
            <h3 class="section-title"><i class="fas fa-tools"></i> Quick Actions</h3>
        </div>
        <div class="action-grid">
            <a href="{{ url_for('admin_users') }}" class="action-btn">
                <i class="fas fa-users"></i> Manage Users
            </a>
            <a href="{{ url_for('admin_transactions') }}" class="action-btn">
                <i class="fas fa-coins"></i> Transactions
            </a>
            <a href="{{ url_for('admin_withdrawals') }}" class="action-btn">
                <i class="fas fa-money-bill-wave"></i> Withdrawals
            </a>
            <a href="{{ url_for('admin_sponsorships') }}" class="action-btn">
                <i class="fas fa-ad"></i> Sponsorships
            </a>
            <a href="{{ url_for('gallery') }}" class="action-btn">
                <i class="fas fa-th"></i> Gallery
            </a>
            <a href="{{ url_for('index') }}" class="action-btn">
                <i class="fas fa-home"></i> Home
            </a>
        </div>
    </div>
</div>
{% endblock %}
